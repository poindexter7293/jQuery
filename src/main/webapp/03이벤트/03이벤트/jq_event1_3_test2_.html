<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>장바구니 예제</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        table {
            margin: 0 auto;
            border-collapse: collapse;
            width: 80%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f4f4f4;
        }
        .button {
            padding: 5px 10px;
            cursor: pointer;
            margin: 2px;
        }
    </style>
</head>
<body>

<h1>온라인 쇼핑몰</h1>
<h2>상품 목록</h2>
<table id="productTable">
    <thead>
        <tr>
            <th>상품명</th>
            <th>가격</th>
            <th>추가</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>상품 1</td>
            <td>10,000원</td>
            <td><button class="add-to-cart button">장바구니에 추가</button></td>
        </tr>
        <tr>
            <td>상품 2</td>
            <td>20,000원</td>
            <td><button class="add-to-cart button">장바구니에 추가</button></td>
        </tr>
        <tr>
            <td>상품 3</td>
            <td>30,000원</td>
            <td><button class="add-to-cart button">장바구니에 추가</button></td>
        </tr>
    </tbody>
</table>

<div id="cart">
    <h2>장바구니</h2>
    <table id="cartTable">
        <thead>
            <tr>
                <th>상품명</th>
                <th>수량</th>
                <th>총 가격</th>
                <th>삭제</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <button id="clearCart" class="button">장바구니 비우기</button>
</div>
<!--
jQuery의 off() 메소드를 활용하여 장바구니의 상품을 추가하고, 
해당 상품의 수량을 조절하며, 
필요 시 이벤트를 제거하는 예제를 만들어보자. 
장바구니에서 상품 수량을 증가 또는 감소시키는 버튼을 클릭할 때 
해당 이벤트를 동적으로 추가하고 제거하는 방식을 보여줍니다.
-->
<script>
		//장바구니를 나타내는 비어있는 객체 {} 생성합니다.
		//참고. 여기서 상품명을 속성명으로 작성하고, 가격과 수량을 값으로  저장할 것입니다.
		//     {"상품명1":"가격과수량",  "상품명2":"가격과수량"  }
		let cart = {};

		//장바구니 상품 추가 button 3개를 모두 선택해서 가져와 "click"이벤트 등록
		//또한 3개의 button중에  하나의 버튼에 "click"이벤트가 발생하면  실행되는 이벤트 핸들러 함수 정의
		$(".add-to-cart").on("click", function(){
			
			//$(this)  <- click이벤트가 발생한 <button class="add-to-cart button">장바구니에 추가</button> 요소 선택 함.
			 
			//$(this).closest(selectors);
			//- $(this) : 탐색을 시작할 <button class="add-to-cart button">장바구니에 추가</button>요소.
			//- selectors : 찾고자 하는 상위 요소의 CSS선택자 문법 (예:  '.my-class', 'div')
			
			//1. click된 장바구니 추가 <button>을 감싸고 있는 부모 <tr>..</tr>요소를 찾아 선택해서 가져옴
			let row = $(this).closest('tr');
            /*
            <tr>
                <td>상품 1</td>
                <td>10,000원</td>
                <td><button class="add-to-cart button">장바구니에 추가</button></td>
            </tr>
       		 */
       		//2. 해당 행의 첫번째 <td>상품 1</td> 셀에서 '상품 1'을 가져옵니다.
       		//-> click한 장바구니 추가 <button> 행의 상품명 -> '상품 1' 얻기 
       		let productName = row.find('td:first').text();
       		//	'상품 1'
       		//  '상품 2'
       		
       		//3. 가격'10,000원'을 가져와서 숫자로 변환합니다.
       		//여기서 replace()메소드를 사용하여 문자열에서 쉼표와 "원"을 제거합니다.
            /*
            <tr>
                <td>상품 1</td>
                <td>10,000원</td>
                <td><button class="add-to-cart button">장바구니에 추가</button></td>
            </tr>
            요소에서........... 두번째 <td>10,000원</td>를 얻어 .text()메소드로 "10,000원"을 얻고
            "10,000원".replace(',','')를 호출하여  ,문자를 ''으로 치환한 전체 문자열 "10 000원"을 얻고
            "10 000원".replqce('원','')를 호출하여 '원'문자를  ''으로 치환한 전체 문자열 "10 000 "을 얻는다.
       		 */       		
			let productPrice = parseInt(row.find('td:nth-child(2)').text().replace(',',  '').replace('원',''));
															   //"10,000원".replace(',',  '').replace('원','');
															   //			       "10 000원".replace('원','');
															   //							  "10 000 "
															   //							 parseInt("10 000 ");
															   //									10000
		
			//3. 장바구니 cart  {}객체에 상품 추가 또는 수량 증가 
			
				//장바구니 역할을 하는 cart {}객체에 해당 상품이 이미 저장되어 있으면?
				if(cart[productName]){
				  /*
				   cart[productName] 는  객체(cart)에서 특정 속성명(productName)를 이용해 값을 저장하거나 불러오는 방법
				   
				    cart객체 모습 
  				  	{
						"상품 1" : { price:10000,quantity: 1},
  					}
				  */
				  //이미 같은 상품 1이 장바구니 cart객체에 추가되어 있으면? 수량만 증가 
				            cart[productName].quantity++;
			    // { price:10000,quantity: 1}.quantity++;
				// { price:10000,quantity: 2}  <---- 수량을 1에서 2로 증가 시킴 
				  
					
				}else{//장바구니 역할을 하는 cart {}객체에 해당 상품의 정보가 없으면?
					
						//새로운 상품정보를 cart {}객체에 "상품명":"가격" 으로  추가
						cart[productName] = { price:productPrice,  quantity: 1};
					   //cart[상품 1]      = { price:10000,         quantity: 1};
						
						//let cart = {  "상품 1": { price:10000,    quantity: 1}    };		
				}
				
			//4. 장바구니 화면을 업데이트 하는 함수 호출
			updateCart();
															   
		});//<- on(fuction(){     }); <-------------- 이부분 임 
		
		//4-1. 장바구니 화면을 업데이트 하는 기능의 함수 정의
		function updateCart(){

			//장바구니 테이블의 <tbody></tbody>요소 영역을 선택해서 저장
			let cartTableBody = $("#cartTable tbody");
		
			//만약 <tbody>....</tbody>사이에 추가된 상품정보가 있으면 모든 자식요소들 제거 (비우자)
			cartTableBody.empty();
			
			//장바구니 테이블 <tbody></tbody>에 표시할 상품들의 총가격을 저장할 변수 선언 
			let totalPrice = 0;
			/*
				cart객체(장바구니)
				
					{
						"상품 1" : { price:10000,quantity: 1},
						"상품 2" : { price:20000,quantity: 1} 
					}		
			*/
			//cart 객체를 순회하면서 각 상품의 이름과 가격과수량정보에 접근해서 사용
			$.each(cart, function(name, item){
						      //"상품 1", { price:10000,quantity: 1}  <- function이  한번 호출 될때 매개변수로 받음
						      //"상품 2", { price:20000,quantity: 1}  <- function이  두번 호출 될때 매개변수로 받음

//장바구니 추가버튼을 클릭한 행의 상품 가격			=	가격         X        수량  
						let totalItemPrice	=	item.price  *        item.quantity
			//									10000		*		  1
			//									20000       *         1
	
					   //장바구니 추가버튼을 클릭한 행의 상품 가격들을  totalPrice변수에 누적!
						totalPrice += totalItemPrice;
					//    0        +=  10000
					//  10000
					
					//  10000      +=   20000;
					//  30000
						      
					   //장바구니 추가버튼을 클릭했으므로 
					   //<tbody>...</tbody>사이에  새로운 <tr>...</tr>을 생성 하여 동적으로 보내어 추가 
						cartTableBody.append(`
							<tr>		
								<td>${name}</td>
								<td>
									<button class="decrease-quantity button">-</button>
									<span>${item.quantity}</span>
									<button class="increase-quantity button">+</button>
								</td>
								<td>${totalItemPrice.toLocaleString()}원</td>
								<td><button class="remove-item button">삭제</button></td>
							</tr> 
						`);				
			});//  $.each 메소드 호출 끝
			
			// 장바구니에 추가한 상품들의 ~~~ 총 가격 을 표시할 행을 추가 
			//<tbody></tbody>.append('<tr>행을 만들어 총가격 정보 추가');
			cartTableBody.append(`
								 <tr>		
									<td colspan="2"><strong>총가격</strong></td>
									<td colspan="2"><strong>${totalPrice.toLocaleString()}</strong></td>
								 </tr>
								`);
				
		//수량 증가 <button class="increase-quantity button">+</button> 요소 선택 후 click이벤트 등록			
			$('.increase-quantity').off('click').on('click',function(){ 		
								
				//click이벤트가 발생한 <button>이 속한 상품의 이름을 찾아야 합니다.
				
				//$(this) -> 현재 click이벤트가 발생된  + <button>요소를 선택해서 가져온다.
				
				//$(this).closest('tr')  -> click이벤트가 발생된 + <button>요소를 감싸서 작성된 상위 <tr></tr>한쌍을 선택해서 가져온다.
				
				//$(this).closest('tr').find("td:first")  -> 해당 행에서 첫 번째 <td>요소를 선택. (상품명을 포함하고 있음)
				
				//$(this).closest('tr').find("td:first").text() -> 첫 번째 <td>요소 사이의 상품명을 얻습니다
				let productName = $(this).closest('tr').find("td:first").text();
				console.log(productName);
				// + 버튼을 클릭한 행의 해당 상품명 얻기 
        	 /*
	 	        cart(장바구니)객체
	 	              {
	 			                    상품 1 : {price: 10000, quantity: 1},
	 			                    상품 2 : {price: 20000, quantity: 1}
	 	              }

 	         */
 	         	console.log("수량 증가 전 : " , cart[productName] );
 	        	cart[productName].quantity++; //그 상품의 수량 1증가 해서 저장 
// 	  {price: 10000, quantity: 1}.quantity++;
				console.log("수량 증가 후 : ", cart[productName] );
				
				//장바구니 화면을 업데이트하여 화면 반영하는 기능의 함수 호출
	        	updateCart();
			});

		// 수량 감소 - <button>버튼 요소에 click이벤트 등록 후 처리 
		//<button class="decrease-quantity button">-</button> 수량 1감소 버튼에 click이벤트 등록
		$(".decrease-quantity").off('click').on('click',function(){
    		
	   		//수량을 감소시킬 상품의 이름을 가져와야 한다.
	   		//이유 : cart객체{}내부에 저장된  "상품의 이름"을 "속성명"로 사용해서 
	   		//     값-> {price:10000, quantity:2}객체를 꺼내와 수량quantity을 1감소 시키기 위해
/*
         $(this): 현재 클릭된 버튼을 참조합니다.
         .closest('tr'): 클릭된 버튼이 속한 가장 가까운 <tr>(행) 요소를 찾습니다. 이는 해당 상품의 정보를 포함하는 행입니다.
         .find('td:first'): 해당 행에서 첫 번째 <td>(셀) 요소를 찾습니다. 이 셀은 상품명을 포함하고 있습니다.
         .text(): 셀의 텍스트 내용을 가져옵니다. 즉, 상품명을 가져오는 것입니다.
*/		   		
	   		let productName = $(this).closest('tr').find('td:first').text(); 
			
	         //설명: 현재 상품의 수량이 1보다 큰지 확인합니다.
	         //목적: 수량이 1보다 크면 수량을 감소시키고, 그렇지 않으면 해당 상품을 장바구니에서 삭제합니다.
	        if(cart[productName].quantity  > 1){
                /*
                설명:
                    cart: 장바구니 객체입니다. 여기에는 상품명(키)에 해당하는 객체가 포함되어 있습니다.
                    cart[productName]: 방금 가져온 상품명을 키로 사용하여 해당 상품의 객체에 접근합니다.
                    .quantity--: 해당 상품의 수량을 1 감소시킵니다.
		                     목적: 수량감소 버튼 - 를 클릭한 상품의 수량을 감소시켜 장바구니(cart객체)에 반영하기 위함입니다.
 				*/ 
	        	cart[productName].quantity--;  
                    
          	 /*
             설명: 만약 현재 상품의 수량이 1 이하라면, 해당 상품을 장바구니에서 삭제합니다.
             목적: 수량이 0이 되면 장바구니에서 해당 상품을 제거하여 불필요한 데이터를 삭제합니다.
      		*/  	        
	        }else{
				
	        	delete  cart[productName];  //수량이 0이 되면  해당 상품을 cart {  } 객체 내부에서 삭제 
   			 /*
   			 cart객체 모습 
 			 	{						
 			           상품 1 : {price: 10000, quantity: 0} <----- 삭제
 			 	}
 			*/	        
	        }
	         
	        /*
            설명: 장바구니의 내용을 업데이트하는 함수를 호출합니다. 이 함수는 장바구니의 현재 상태를 화면에 반영합니다.
            목적: 수량이 변경된 후 장바구니의 내용을 새로고침하여 사용자에게 최신 정보를 보여주기 위함입니다.
   			*/ 	         
	         updateCart();   
		});
		
		//삭제 버튼 <button class="remove-item button">삭제</button>에  click이벤트 등록 후 처리 
		$(".remove-item").off("click").on("click",function(){
  		 
     		//클릭한 삭제버튼을 선택해서 가져와
     		//삭제 버튼을 감싸고 있는 상위 <tr></tr>을 선택해서 가져와
     		//<tr></tr>내부에 적힌 첫번째 자식<td>상품 1</td>을 선택해서
     		//"상품 1" <- 상품명을 얻어   prdocuName변수에 저장
			let productName = $(this).closest('tr').find('td:first').text();
    		/*
			delete 예약어를 이용해
		
			let cart = {
							"상품1": { "price":10000,  "quantity":1},
							"상품2": { "price":20000,  "quantity":2}
						};
		
		        위 cart객체에 저장된 "상품1"의 객체 정보 삭제 !
			*/		
     		delete  cart[productName];
     		
		    //장바구니의 현재 상태를 화면에 반영 하기 위해 호출!
		    updateCart();
     		
		});
		
		//<button id="clearCart" class="button">장바구니 비우기<button>에 click이벤트 등록 후 처리 
		$("#clearCart").on("click", function(){
			cart = {};
			updateCart();
		});
		
			
					
	}//--------------updateCart 함수 닫는 중괄호 기호 
		
		
		
		
	 /*
        .off('click')를 사용하는 이유
            
        1. 이벤트 중복 방지:
        .on('click', ...)을 여러 번 호출하면, 
                동일한 버튼에 대해 클릭 이벤트가 여러 번 등록될 수 있습니다. 
                이 경우 버튼을 클릭할 때마다 여러 번의 함수가 실행될 수 있습니다.
                예를 들어, 사용자가 수량 증가 버튼을 여러 번 클릭하면, 
                수량이 예상보다 더 많이 증가할 수 있습니다.
        2.동적 요소 처리:
                웹 페이지에서 동적으로 생성되는 요소에 이벤트를 등록할 때, 
                이전 이벤트 핸들러를 제거하지 않으면 문제가 발생할 수 있습니다. 
                동적으로 생성된 버튼에 대해 여러 번 이벤트가 등록될 수 있습니다.
    */	
 
</script>

</body>
</html>
















